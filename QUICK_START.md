# BaaS JS - ÂâçÁ´ØÂø´ÈÄü‰ΩøÁî®ÊâãÂÜå

## üì¶ ÂÆâË£Ö

```bash
npm install baas_js

yarn add baas_js
```

## üöÄ 5ÂàÜÈíüÂø´ÈÄü‰∏äÊâã

### 1. ÂàùÂßãÂåñÂÆ¢Êà∑Á´Ø

```javascript
import { createClient } from 'baas_js';

// Âú®È°πÁõÆÂÖ•Âè£Êñá‰ª∂ÔºàÂ¶Ç main.js Êàñ App.vueÔºâ‰∏≠ÂàùÂßãÂåñ
const client = createClient({
  baseUrl: 'https://your-api.example.com',  // ‰Ω†ÁöÑÂêéÁ´ØÂú∞ÂùÄ
  apiKey: 'YOUR_API_KEY'                     // ‰Ω†ÁöÑ API Key
});

// ÂØºÂá∫‰æõÂÖ®Â±Ä‰ΩøÁî®
export default client;
```

### 2. Áî®Êà∑ËÆ§ËØÅ

#### ÁôªÂΩï

```javascript
// ÊîØÊåÅ‰∏âÁßçÁôªÂΩïÊñπÂºèÔºöÊâãÊú∫Âè∑„ÄÅÈÇÆÁÆ±„ÄÅÁî®Êà∑Âêç
await client.auth.login({
  phone: '13800000000',
  password: '123456'
});

// Êàñ‰ΩøÁî®ÈÇÆÁÆ±
await client.auth.login({
  email: 'user@example.com',
  password: '123456'
});

// Êàñ‰ΩøÁî®Áî®Êà∑Âêç
await client.auth.login({
  user_name: 'john_doe',
  password: '123456'
});
```

#### Ê≥®ÂÜå

```javascript
await client.auth.register({
  user_name: 'john_doe',
  phone: '13800000000',
  email: 'john@example.com',
  password: '123456',
  // ÂÖ∂‰ªñËá™ÂÆö‰πâÂ≠óÊÆµ...
});
```

#### Ëé∑ÂèñÂΩìÂâçÁî®Êà∑‰ø°ÊÅØ

```javascript
const userInfo = await client.auth.getUser();
console.log(userInfo);
```

#### ÁôªÂá∫

```javascript
await client.auth.logout();
```

### 3. Êï∞ÊçÆÂ∫ìÊìç‰ΩúÔºàÈáçÁÇπÔºÅÔºâ

#### Êü•ËØ¢Êï∞ÊçÆ

```javascript
// Ëé∑ÂèñÂàóË°®
const todos = await client.db
  .from('todos')
  .list();

// Â∏¶Êù°‰ª∂Êü•ËØ¢
const openTodos = await client.db
  .from('todos')
  .list()
  .eq('status', 'open')              // status = 'open'
  .order('created_at', 'desc');      // ÊåâÂàõÂª∫Êó∂Èó¥ÂÄíÂ∫è

// ÂàÜÈ°µÊü•ËØ¢
const page1 = await client.db
  .from('products')
  .list()
  .page(1, 10);  // Á¨¨1È°µÔºåÊØèÈ°µ10Êù°

// Ëé∑ÂèñÂçïÊù°Êï∞ÊçÆ
const todo = await client.db
  .from('todos')
  .get()
  .eq('id', 123);
```

#### È´òÁ∫ßÊü•ËØ¢

```javascript
// Â§ß‰∫é„ÄÅÂ∞è‰∫é
const expensiveProducts = await client.db
  .from('products')
  .list()
  .gt('price', 100)    // price > 100
  .lt('price', 500);   // price < 500

// IN Êü•ËØ¢
const items = await client.db
  .from('orders')
  .list()
  .in('status', ['paid', 'shipped', 'delivered']);

// BETWEEN Êü•ËØ¢
const recentOrders = await client.db
  .from('orders')
  .list()
  .between('created_at', ['2025-01-01', '2025-12-31']);

// OR Êù°‰ª∂Ôºà‰ºòÊÉ†ËÆ¢ÂçïÔºöÈáëÈ¢ùÂ∞è‰∫é100 Êàñ ÊúâÊäòÊâ£Ôºâ
const discountedOrders = await client.db
  .from('orders')
  .list()
  .or(q => 
    q.lt('amount', 100)
     .gt('discount', 0)
  );

// Â§çÊùÇÊü•ËØ¢Á§∫‰æã
const results = await client.db
  .from('products')
  .list()
  .eq('category', 'electronics')
  .gt('rating', 4.0)
  .or(q => q.lt('price', 50).eq('on_sale', true))
  .order('price', 'asc')
  .page(1, 20);
```

#### ÊèíÂÖ•Êï∞ÊçÆ

```javascript
const newTodo = await client.db
  .from('todos')
  .insert()
  .values({
    title: '‰π∞ÁâõÂ•∂',
    status: 'open',
    created_at: new Date().toISOString()
  });
```

#### Êõ¥Êñ∞Êï∞ÊçÆ

```javascript
// Êõ¥Êñ∞ÊåáÂÆö ID ÁöÑÊï∞ÊçÆ
const updated = await client.db
  .from('todos')
  .update()
  .set({ status: 'closed' })
  .eq('id', 123);

// ÊâπÈáèÊõ¥Êñ∞
const batchUpdated = await client.db
  .from('orders')
  .update()
  .set({ status: 'cancelled' })
  .lt('created_at', '2024-01-01');  // Êõ¥Êñ∞2024Âπ¥‰πãÂâçÁöÑËÆ¢Âçï
```

#### Âà†Èô§Êï∞ÊçÆ

```javascript
// Âà†Èô§ÊåáÂÆö ID
await client.db
  .from('todos')
  .delete()
  .eq('id', 123);

// ÊâπÈáèÂà†Èô§
await client.db
  .from('logs')
  .delete()
  .lt('created_at', '2024-01-01');  // Âà†Èô§ÊóßÊó•Âøó
```

### 4. Ë∞ÉÁî®Ëá™ÂÆö‰πâ API

```javascript
// ÁÆÄÂçïË∞ÉÁî®
const result = await client.api
  .call('send_sms')
  .param('phone', '13800000000')
  .param('code', '123456');

// ‰º†ÈÄíÂ§ö‰∏™ÂèÇÊï∞
const data = await client.api
  .call('send_email')
  .params({
    to: 'user@example.com',
    subject: 'Ê¨¢ËøéÊ≥®ÂÜå',
    content: 'ÊÑüË∞¢ÊÇ®ÁöÑÊ≥®ÂÜåÔºÅ'
  });

// Ê∑ªÂä†Ëá™ÂÆö‰πâËØ∑Ê±ÇÂ§¥
const response = await client.api
  .call('process_payment')
  .params({
    order_id: '12345',
    amount: 99.99
  })
  .header('X-Request-Id', 'req-001')
  .headers({
    'X-Trace-Id': 'trace-001',
    'X-Client-Version': '1.0.0'
  });
```

## üéØ Â∏∏ËßÅ‰∏öÂä°Âú∫ÊôØ

### Âú∫ÊôØ1ÔºöÂ∏¶ÊêúÁ¥¢ÁöÑÂïÜÂìÅÂàóË°®

```javascript
// ÊêúÁ¥¢ÁªÑ‰ª∂
async function searchProducts(keyword, category, page = 1) {
  const query = client.db
    .from('products')
    .list()
    .page(page, 20);
  
  if (category) {
    query.eq('category', category);
  }
  
  // ÂÅáËÆæÂêéÁ´ØÊîØÊåÅÂÖ≥ÈîÆËØçÊêúÁ¥¢
  if (keyword) {
    query.eq('name', keyword);  // ÂÆûÈôÖÂèØËÉΩÈúÄË¶ÅÂêéÁ´ØÊîØÊåÅÊ®°Á≥äÊêúÁ¥¢
  }
  
  return await query.order('created_at', 'desc');
}

// ‰ΩøÁî®
const products = await searchProducts('ÊâãÊú∫', 'electronics', 1);
```

### Âú∫ÊôØ2ÔºöÁî®Êà∑Ë¥≠Áâ©ËΩ¶

```javascript
// Ê∑ªÂä†Âà∞Ë¥≠Áâ©ËΩ¶
async function addToCart(productId, quantity) {
  return await client.db
    .from('cart_items')
    .insert()
    .values({
      product_id: productId,
      quantity: quantity,
      added_at: new Date().toISOString()
    });
}

// Ëé∑ÂèñË¥≠Áâ©ËΩ¶ÂàóË°®
async function getCartItems() {
  return await client.db
    .from('cart_items')
    .list()
    .order('added_at', 'desc');
}

// Êõ¥Êñ∞Ë¥≠Áâ©ËΩ¶Êï∞Èáè
async function updateCartQuantity(cartItemId, quantity) {
  return await client.db
    .from('cart_items')
    .update()
    .set({ quantity })
    .eq('id', cartItemId);
}

// Ê∏ÖÁ©∫Ë¥≠Áâ©ËΩ¶
async function clearCart() {
  const items = await getCartItems();
  for (const item of items.data) {
    await client.db
      .from('cart_items')
      .delete()
      .eq('id', item.id);
  }
}
```

### Âú∫ÊôØ3ÔºöËÆ¢ÂçïÁÆ°ÁêÜ

```javascript
// ÂàõÂª∫ËÆ¢Âçï
async function createOrder(orderData) {
  return await client.db
    .from('orders')
    .insert()
    .values({
      ...orderData,
      status: 'pending',
      created_at: new Date().toISOString()
    });
}

// Ëé∑ÂèñÊàëÁöÑËÆ¢ÂçïÔºàÂ∏¶Á≠õÈÄâÔºâ
async function getMyOrders(status = null, page = 1) {
  const query = client.db
    .from('orders')
    .list()
    .page(page, 10);
  
  if (status) {
    query.eq('status', status);
  }
  
  return await query.order('created_at', 'desc');
}

// ÂèñÊ∂àËÆ¢Âçï
async function cancelOrder(orderId) {
  return await client.db
    .from('orders')
    .update()
    .set({ 
      status: 'cancelled',
      cancelled_at: new Date().toISOString()
    })
    .eq('id', orderId);
}
```

## üí° ÊúÄ‰Ω≥ÂÆûË∑µ

### 1. Â∞ÅË£Ö API Ë∞ÉÁî®

Âª∫ËÆÆÂàõÂª∫‰∏Ä‰∏™ `api` ÁõÆÂΩïÔºåÂ∞ÜÊâÄÊúâ‰∏öÂä°ÈÄªËæëÂ∞ÅË£ÖÔºö

```javascript
// api/user.js
import client from './client';

export const userApi = {
  async login(credentials) {
    return await client.auth.login(credentials);
  },
  
  async register(userData) {
    return await client.auth.register(userData);
  },
  
  async getProfile() {
    return await client.auth.getUser();
  },
  
  async logout() {
    return await client.auth.logout();
  }
};

// api/products.js
import client from './client';

export const productApi = {
  async getList(filters = {}) {
    const query = client.db.from('products').list();
    
    if (filters.category) {
      query.eq('category', filters.category);
    }
    if (filters.minPrice) {
      query.gte('price', filters.minPrice);
    }
    if (filters.maxPrice) {
      query.lte('price', filters.maxPrice);
    }
    
    return await query
      .order('created_at', 'desc')
      .page(filters.page || 1, filters.pageSize || 20);
  },
  
  async getById(id) {
    return await client.db
      .from('products')
      .get()
      .eq('id', id);
  }
};
```

### 2. ÈîôËØØÂ§ÑÁêÜ

```javascript
async function safeApiCall(apiFunction) {
  try {
    const response = await apiFunction();
    
    if (response.success) {
      return { success: true, data: response.data };
    } else {
      return { 
        success: false, 
        error: response.message || 'Êìç‰ΩúÂ§±Ë¥•' 
      };
    }
  } catch (error) {
    console.error('APIË∞ÉÁî®Â§±Ë¥•:', error);
    return { 
      success: false, 
      error: error.message || 'ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï' 
    };
  }
}

// ‰ΩøÁî®Á§∫‰æã
const result = await safeApiCall(() => 
  client.db.from('products').list()
);

if (result.success) {
  console.log('Êï∞ÊçÆ:', result.data);
} else {
  alert(result.error);
}
```

### 3. Âú® Vue 3 ‰∏≠‰ΩøÁî®

```javascript
// plugins/baas.js
import { createClient } from 'baas_js';

export default {
  install(app, options) {
    const client = createClient({
      baseUrl: options.baseUrl,
      apiKey: options.apiKey
    });
    
    app.config.globalProperties.$baas = client;
    app.provide('baas', client);
  }
};

// main.js
import { createApp } from 'vue';
import App from './App.vue';
import baasPlugin from './plugins/baas';

const app = createApp(App);

app.use(baasPlugin, {
  baseUrl: 'https://your-api.example.com',
  apiKey: 'YOUR_API_KEY'
});

app.mount('#app');

// Âú®ÁªÑ‰ª∂‰∏≠‰ΩøÁî®
// <script setup>
import { inject } from 'vue';

const baas = inject('baas');

async function loadData() {
  const products = await baas.db.from('products').list();
  console.log(products);
}
// </script>
```

### 4. Âú® React ‰∏≠‰ΩøÁî®

```javascript
// hooks/useBaas.js
import { createClient } from 'baas_js';

const client = createClient({
  baseUrl: 'https://your-api.example.com',
  apiKey: 'YOUR_API_KEY'
});

export function useBaas() {
  return client;
}

// ÁªÑ‰ª∂‰∏≠‰ΩøÁî®
import { useState, useEffect } from 'react';
import { useBaas } from './hooks/useBaas';

function ProductList() {
  const [products, setProducts] = useState([]);
  const [loading, setLoading] = useState(true);
  const baas = useBaas();
  
  useEffect(() => {
    async function loadProducts() {
      try {
        const response = await baas.db
          .from('products')
          .list()
          .order('created_at', 'desc');
        
        if (response.success) {
          setProducts(response.data);
        }
      } catch (error) {
        console.error('Âä†ËΩΩÂ§±Ë¥•:', error);
      } finally {
        setLoading(false);
      }
    }
    
    loadProducts();
  }, []);
  
  if (loading) return <div>Âä†ËΩΩ‰∏≠...</div>;
  
  return (
    <div>
      {products.map(product => (
        <div key={product.id}>{product.name}</div>
      ))}
    </div>
  );
}
```

## üîë Ê†∏ÂøÉÊ¶ÇÂøµ

### ÈìæÂºèË∞ÉÁî®

ÊâÄÊúâÊï∞ÊçÆÂ∫ìÊìç‰ΩúÈÉΩÊîØÊåÅÈìæÂºèË∞ÉÁî®ÔºåÊúÄÂêé `await` Âç≥ÂèØÔºö

```javascript
const result = await client.db
  .from('table')
  .list()
  .eq('field', 'value')
  .order('date', 'desc')
  .page(1, 10);
```

### Ëá™Âä® Token ÁÆ°ÁêÜ

- ÁôªÂΩïÂêéÔºåSDK Ëá™Âä®Â∞Ü token Â≠òÂÇ®Âà∞ `localStorage`Ôºàkey: `baas_token`Ôºâ
- ÂêéÁª≠ÊâÄÊúâËØ∑Ê±ÇËá™Âä®Âú® Header ‰∏≠Êê∫Â∏¶ `Authorization: Bearer <token>`
- Êó†ÈúÄÊâãÂä®ÁÆ°ÁêÜ token

### ËØ∑Ê±ÇÂ§¥

ÊâÄÊúâËØ∑Ê±ÇËá™Âä®ÂåÖÂê´Ôºö
- `Content-Type: application/json`
- `CODE_FLYING: <apiKey>`Ôºà‰Ω†ÈÖçÁΩÆÁöÑ API KeyÔºâ
- `Authorization: Bearer <token>`ÔºàÁôªÂΩïÂêéËá™Âä®Ê∑ªÂä†Ôºâ

## üìö ËøáÊª§Âô®ÂÆåÊï¥ÂàóË°®

| ÊñπÊ≥ï | ËØ¥Êòé | Á§∫‰æã |
|------|------|------|
| `eq(field, value)` | Á≠â‰∫é | `.eq('status', 'active')` |
| `neq(field, value)` | ‰∏çÁ≠â‰∫é | `.neq('deleted', true)` |
| `gt(field, value)` | Â§ß‰∫é | `.gt('age', 18)` |
| `gte(field, value)` | Â§ß‰∫éÁ≠â‰∫é | `.gte('score', 60)` |
| `lt(field, value)` | Â∞è‰∫é | `.lt('price', 100)` |
| `lte(field, value)` | Â∞è‰∫éÁ≠â‰∫é | `.lte('stock', 10)` |
| `in(field, array)` | Âú®Êï∞ÁªÑ‰∏≠ | `.in('category', ['A', 'B'])` |
| `between(field, [min, max])` | Âú®Âå∫Èó¥ÂÜÖ | `.between('date', ['2025-01-01', '2025-12-31'])` |
| `or(callback)` | OR Êù°‰ª∂ | `.or(q => q.eq('a', 1).eq('b', 2))` |
| `order(field, dir)` | ÊéíÂ∫è | `.order('created_at', 'desc')` |
| `page(num, size)` | ÂàÜÈ°µ | `.page(1, 20)` |

## ‚ùì Â∏∏ËßÅÈóÆÈ¢ò

### Q: Token ËøáÊúüÊÄé‰πàÂäûÔºü
A: ÂêéÁ´ØËøîÂõû 401 Êó∂ÔºåÂâçÁ´ØÈúÄË¶ÅÊ∏ÖÈô§ token Âπ∂ÈáçÊñ∞ÁôªÂΩïÔºö

```javascript
try {
  const data = await client.db.from('products').list();
} catch (error) {
  if (error.status === 401) {
    await client.auth.logout();
    // Ë∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µ
    window.location.href = '/login';
  }
}
```

### Q: Â¶Ç‰ΩïÂà§Êñ≠Áî®Êà∑ÊòØÂê¶Â∑≤ÁôªÂΩïÔºü
A: Ê£ÄÊü• localStorage ‰∏≠ÁöÑ tokenÔºö

```javascript
function isLoggedIn() {
  return !!localStorage.getItem('baas_token');
}
```

### Q: ÊîØÊåÅÊñá‰ª∂‰∏ä‰º†ÂêóÔºü
A: ÂΩìÂâçÁâàÊú¨‰∏çÁõ¥Êé•ÊîØÊåÅÔºåÈúÄË¶ÅÈÄöËøáËá™ÂÆö‰πâ API ÂÆûÁé∞Ôºö

```javascript
// ÂÅáËÆæÂêéÁ´ØÊúâÊñá‰ª∂‰∏ä‰º† API
const formData = new FormData();
formData.append('file', fileObject);

// ÈúÄË¶Å‰ΩøÁî®ÂéüÁîü fetch
const response = await fetch(`${baseUrl}/api/upload`, {
  method: 'POST',
  headers: {
    'CODE_FLYING': apiKey,
    'Authorization': `Bearer ${token}`
  },
  body: formData
});
```

### Q: Âú® Node.js ÁéØÂ¢É‰∏≠‰ΩøÁî®Ôºü
A: SDK ‰æùËµñ `fetch` Âíå `localStorage`ÔºåNode.js ÁéØÂ¢ÉÈúÄË¶Å polyfillÔºö

```javascript
// ÂÆâË£Ö‰æùËµñ
npm install node-fetch node-localstorage

// ‰ΩøÁî®
global.fetch = require('node-fetch');
const { LocalStorage } = require('node-localstorage');
global.localStorage = new LocalStorage('./scratch');

const { createClient } = require('baas_js');
const client = createClient({ baseUrl: '...', apiKey: '...' });
```

## üéâ Âø´ÈÄüÂèÇËÄÉÂç°Áâá

```javascript
// ÂàùÂßãÂåñ
const client = createClient({ baseUrl: '...', apiKey: '...' });

// ËÆ§ËØÅ
await client.auth.login({ phone: '...', password: '...' });
await client.auth.register({ ... });
await client.auth.getUser();
await client.auth.logout();

// Êü•ËØ¢
await client.db.from('table').list();
await client.db.from('table').get().eq('id', 1);

// Â¢ûÂà†Êîπ
await client.db.from('table').insert().values({ ... });
await client.db.from('table').update().set({ ... }).eq('id', 1);
await client.db.from('table').delete().eq('id', 1);

// Ëá™ÂÆö‰πâ API
await client.api.call('api_name').params({ ... });
```

---

üöÄ Áé∞Âú®‰Ω†Â∑≤ÁªèÊéåÊè°‰∫Ü BaaS JS ÁöÑÊ†∏ÂøÉÁî®Ê≥ïÔºåÂºÄÂßãÊûÑÂª∫‰Ω†ÁöÑÂ∫îÁî®ÂêßÔºÅ

ÊúâÈóÆÈ¢òÔºüÊü•ÁúãÂÆåÊï¥ÊñáÊ°£Ôºö[README.md](./README.md)

